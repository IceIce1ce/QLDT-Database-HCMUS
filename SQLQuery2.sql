-- CREATE DATABASE
USE master
GO
CREATE DATABASE QUANLYDETAI
GO
USE QUANLYDETAI
GO

-- CREATE TABLE + PRIMARY KEY
CREATE TABLE THAMGIADT
(
	MAGV CHAR(5),
	MADT CHAR(5),
	STT INT,
	PHUCAP FLOAT,
	KETQUA NVARCHAR(10),
	CONSTRAINT PK_THAMGIADT
	PRIMARY KEY (MAGV, MADT, STT)
)

GO
CREATE TABLE KHOA
(
	MAKHOA VARCHAR(5), 
	TENKHOA NVARCHAR(50), 
	NAMTL INT,
	PHONG CHAR(5),
	DIENTHOAI CHAR(10),
	TRUONGKHOA CHAR(5),
	NGAYNHANCHUC DATE,
	CONSTRAINT PK_KHOA
	PRIMARY KEY(MAKHOA)
)

GO
CREATE TABLE GIAOVIEN
(
	MAGV CHAR(5),
	HOTEN NVARCHAR(50),
	LUONG FLOAT,
	PHAI NVARCHAR(5),
	NGAYSINH DATE,
	DIACHI NVARCHAR(100),
	GVQLCM CHAR(5),
	MABM NVARCHAR(5),
	CONSTRAINT PK_GIAOVIEN
	PRIMARY KEY(MAGV)
)

GO
CREATE TABLE BOMON
(
	MABM NVARCHAR(5),
	TENBM NVARCHAR(50),
	PHONG CHAR(5),
	DIENTHOAI CHAR(10),
	TRUONGBM CHAR(5),
	MAKHOA VARCHAR(5),
	NGAYNHANCHUC DATE,
	CONSTRAINT PK_BOMON
	PRIMARY KEY (MABM)
)

GO
CREATE TABLE CONGVIEC
(
	MADT CHAR(5),
	SOTT INT,
	TENCV NVARCHAR(50),
	NGAYBD DATE,
	NGAYKT DATE,
	CONSTRAINT PK_CONGVIEC
	PRIMARY KEY (MADT, SOTT)
)

GO
CREATE TABLE DETAI
(
	MADT CHAR(5),
	TENDT NVARCHAR(50),
	CAPQL NVARCHAR(15),
	KINHPHI FLOAT,
	NGAYBD DATE,
	NGAYKT DATE,
	MACD NVARCHAR(5),
	GVCNDT CHAR(5),
	CONSTRAINT PK_DETAI
	PRIMARY KEY (MADT)
)

GO
CREATE TABLE CHUDE
(
	MACD NVARCHAR(5),
	TENCD NVARCHAR(50),
	CONSTRAINT PK_CHUDE
	PRIMARY KEY (MACD)
)

GO
CREATE TABLE NGUOITHAN
(
	MAGV CHAR(5),
	TEN NVARCHAR(10),
	NGAYSINH DATE,
	PHAI NVARCHAR(5),
	CONSTRAINT PK_NGUOITHAN
	PRIMARY KEY (MAGV, TEN)
)

GO
CREATE TABLE GV_DT
(
	MAGV CHAR(5),
	DIENTHOAI CHAR(10),
	CONSTRAINT PK_GV_DT
	PRIMARY KEY (MAGV, DIENTHOAI)
)

-- CREATE FOREIGN KEY
ALTER TABLE GV_DT
ADD CONSTRAINT FK_DVDT_GIAOVIEN
FOREIGN KEY (MAGV)
REFERENCES GIAOVIEN (MAGV)

ALTER TABLE NGUOITHAN
ADD CONSTRAINT FK_NGUOITHAN_GV
FOREIGN KEY (MAGV)
REFERENCES GIAOVIEN (MAGV)

ALTER TABLE DETAI
ADD CONSTRAINT FK_DETAI_CHUDE
FOREIGN KEY (MACD)
REFERENCES CHUDE (MACD)

ALTER TABLE DETAI
ADD CONSTRAINT FK_DETAI_GIAOVIEN
FOREIGN KEY (GVCNDT)
REFERENCES GIAOVIEN (MAGV)

ALTER TABLE CONGVIEC
ADD CONSTRAINT FK_CONGVIEC_DETAI
FOREIGN KEY (MADT)
REFERENCES DETAI (MADT)

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_THAMGIADT_CONGVIEC
FOREIGN KEY (MADT, STT)
REFERENCES CONGVIEC (MADT, SOTT)

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_THAMGIADT_GIAOVIEN
FOREIGN KEY (MAGV)
REFERENCES GIAOVIEN (MAGV)

ALTER TABLE KHOA
ADD CONSTRAINT FK_KHOA_GIAOVIEN
FOREIGN KEY (TRUONGKHOA)
REFERENCES GIAOVIEN (MAGV)

ALTER TABLE BOMON
ADD CONSTRAINT FK_BOMON_KHOA
FOREIGN KEY (MAKHOA)
REFERENCES KHOA (MAKHOA)

ALTER TABLE BOMON
ADD CONSTRAINT FK_BOMON_GIAOVIEN
FOREIGN KEY (TRUONGBM)
REFERENCES GIAOVIEN (MAGV)

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_GIAOVIEN_BOMON
FOREIGN KEY (MABM)
REFERENCES BOMON (MABM)

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_GIAOVIEN_GIAOVIEN
FOREIGN KEY (GVQLCM)
REFERENCES GIAOVIEN (MAGV)

-- if not have input, take current day
ALTER TABLE dbo.BOMON
ADD CONSTRAINT DF_NGAYNHANCHUC
DEFAULT(GETDATE()) FOR NGAYNHANCHUC

-- CREATE OBLIGATION 
GO
ALTER TABLE GIAOVIEN
ADD CONSTRAINT C_PHAI_GV
CHECK (PHAI IN ('Nam', N'Nữ'))

ALTER TABLE NGUOITHAN
ADD CONSTRAINT C_PHAI_NT
CHECK (PHAI IN ('Nam', N'Nữ'))

-- INPUT DATA
GO
INSERT INTO CHUDE(MACD, TENCD) VALUES ('NCPT', N'Nghiên cứu phát triển')
INSERT INTO CHUDE(MACD, TENCD) VALUES ('QLGD', N'Quản lý giáo dục')
INSERT INTO CHUDE(MACD, TENCD) VALUES ('UDCN', N'Ứng dụng công nghệ')

GO
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('001', N'Nguyễn Hoài An', 2000, 'Nam', '02/15/1973', N'25/3 Lạc Long Quân, Q.10, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('002', N'Trần Trà Hương', 2500, N'Nữ', '06/20/1960', N'125 Trần Hưng Đạo, Q.1, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('003', N'Nguyễn Ngọc Ánh', 2200, N'Nữ', '05/11/1975', N'12/21 Võ Văn Ngân Thủ Đức, TP HCM', '002', NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('004', N'Trương Nam Sơn', 2300, 'Nam', '06/20/1959', N'215 Lý Thường Kiệt, TP Biên Hòa', NULL, NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('005', N'Lý Hoàng Hà', 2500, 'Nam', '10/23/1954', N'22/5 Nguyễn Xí, Q.Bình Thạnh, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('006', N'Trần Bạch Tuyết', 1500, N'Nữ', '05/20/1980', N'127 Hùng Vương, TP Mỹ Tho', '004', NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('007', N'Nguyễn An Trung', 2100, 'Nam', '06/05/1976', N'234 3/2, TP Biên Hòa', NULL, NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('008', N'Trần Trung Hiếu', 1800, 'Nam', '08/06/1977', N'22/11 Lý Thường Kiệt, TP Mỹ Tho', '007', NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('009', N'Trần Hoàng Nam', 2000, 'Nam', '11/22/1975', N'234 Trần Não, An Phú, TP HCM', '001', NULL)
INSERT INTO GIAOVIEN(MAGV, HOTEN, LUONG, PHAI, NGAYSINH, DIACHI, GVQLCM, MABM)
	VALUES ('010', N'Phạm Nam Thanh', 1500, 'Nam', '12/12/1980', N'221 Hùng Vương, Q.5, TP HCM', '007', NULL)

GO
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('001', '0838912112')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('001', '0903123123')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('002', '0913454545')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('003', '0838121212')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('003', '0903656565')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('003', '0937125125')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('006', '0937888888')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('008', '0653717171')
INSERT INTO GV_DT(MAGV, DIENTHOAI) VALUES ('008', '0913232323')

GO
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('001', N'Hùng', '01/14/1990', 'Nam')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('001', N'Thủy', '12/08/1994', N'Nữ')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('003', N'Hà', '09/03/1998', N'Nữ')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('003', 'Thu', '09/03/1998', N'Nữ')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('007', 'Mai', '03/26/2003', N'Nữ')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('007', 'Vy', '02/14/2000', N'Nữ')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('008', 'Nam', '05/06/1991', 'Nam')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('009', 'An', '08/19/1996', 'Nam')
INSERT INTO NGUOITHAN(MAGV, TEN, NGAYSINH, PHAI) VALUES ('010', N'Nguyệt', '01/14/2006', N'Nữ')

GO
INSERT INTO KHOA(MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
	VALUES ('CNTT', N'Công nghệ thông tin', '1995', 'B11', '0838123456', '002', '02/20/2005')
INSERT INTO KHOA(MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
	VALUES ('HH', N'Hóa học', '1980', 'B41', '0838456456', '007', '10/15/2001')
INSERT INTO KHOA(MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
	VALUES ('SH', N'Sinh học', '1980', 'B31', '0838454545', '004', '10/11/2000')
INSERT INTO KHOA(MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
	VALUES ('VL', N'Vật lý', '1976', 'B21', '0838223223', '005', '09/18/2003')

GO
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('CNTT', N'Công nghệ tri thức', 'B15', '0838126126', NULL, 'CNTT', NULL)
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('HHC', N'Hóa hữu cơ', 'B44', '0838222222', NULL, 'HH', NULL)
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('HL', N'Hóa lý', 'B42', '0838878787', NULL, 'HH', NULL)
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('HPT', N'Hóa phân tích', 'B43', '0838777777', '007', 'HH', '10/15/2007')
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('HTTT', N'Hệ thống thông tin', 'B13', '0838125125', '002', 'CNTT', '09/20/2004')
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('MMT', N'Mạng máy tính', 'B16', '0838676767', '001', 'CNTT', '05/15/2005')
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('SH', N'Sinh hóa', 'B33', '0838898989', NULL, 'SH', NULL)
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES (N'VLĐT', N'Vật lý điện tử', 'B23', '0838234234', NULL, 'VL', NULL)
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('VLUD', N'Vật lý ứng dụng', 'B24', '0838454545', '005', 'VL', '02/18/2006')
INSERT INTO BOMON(MABM, TENBM, PHONG, DIENTHOAI, TRUONGBM, MAKHOA, NGAYNHANCHUC)
	VALUES ('VS', N'Vi sinh', 'B32', '0838909090', '004', 'SH', '01/01/2007')

GO
UPDATE GIAOVIEN SET MABM = 'MMT' WHERE (MAGV = '001') OR (MAGV = '009')
UPDATE GIAOVIEN SET MABM = 'HTTT' WHERE (MAGV = '002') OR (MAGV = '003')
UPDATE GIAOVIEN SET MABM = 'VS' WHERE (MAGV = '004') OR (MAGV = '006')
UPDATE GIAOVIEN SET MABM = N'VLĐT' WHERE MAGV = '005'
UPDATE GIAOVIEN SET MABM = 'HPT' WHERE (MAGV = '007') OR (MAGV = '008') OR (MAGV = '010')

GO
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('001', N'HTTT quản lý các trường ĐH', N'ĐHQG', 20, '10/20/2007', '10/20/2008', 'QLGD', '002')
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('002', N'HTTT quản lý giáo vụ cho một Khoa', N'Trường', 20, '10/12/2000', '10/12/2001', 'QLGD', '002')
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('003', N'Nghiên cứu chế tạo sợi Nanô Platin', N'ĐHQG', 300, '05/15/2008', '05/15/2010', 'NCPT', '005')
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('004', N'Tạo vật liệu sinh học bằng màng ối người', N'Nhà nước', 100, '01/01/2007', '12/31/2009', 'NCPT', '004')
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('005', N'Ứng dụng hóa học xanh', N'Trường', 200, '10/10/2003', '12/10/2004', 'UDCN', '007')
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('006', N'Nghiên cứu tế bào gốc', N'Nhà nước', 4000, '10/20/2006', '10/20/2009', 'NCPT', '004')
INSERT INTO DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
	VALUES ('007', N'HTTT quản lý thư viện ở các trường ĐH', N'Trường', 20, '05/10/2009', '05/10/2010', 'QLGD', '001')

GO
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('001', 1, N'Khởi tạo và Lập kế hoạch', '10/20/2007', '12/20/2008')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('001', 2, N'Xác định yêu cầu', '12/21/2008', '03/21/2008')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('001', 3, N'Phân tích hệ thống', '03/22/2008', '05/22/2008')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('001', 4, N'Thiết kế hệ thống', '05/23/2008', '06/23/2008')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('001', 5, N'Cài đặt thử nghiệm', '06/24/2008', '10/20/2008')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('002', 1, N'Khởi tạo và Lập kế hoạch', '05/10/2009', '07/10/2009')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('002', 2, N'Xác định yêu cầu', '07/11/2009', '10/11/2009')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('002', 3, N'Phân tích hệ thống', '10/12/2009', '12/20/2009')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('002', 4, N'Thiết kế hệ thống', '12/21/2009', '03/22/2010')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('002', 5, N'Cài đặt thử nghiệm', '03/23/2010', '05/10/2010')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('006', 1, N'Lấy mẫu', '10/20/2006', '02/20/2007')
INSERT INTO CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
	VALUES ('006', 2, N'Nuôi cấy', '02/21/2007', '08/21/2008')

GO
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('001', '002', 1, 0, NULL)
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('001', '002', 2, 2, NULL)
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('002', '001', 4, 2, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('003', '001', 1, 1, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('003', '001', 2, 0, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('003', '001', 4, 1, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('003', '002', 2, 0, NULL)
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('004', '006', 1, 0, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('004', '006', 2, 1, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('006', '006', 2, 1.5, N'Đạt')
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('009', '002', 3, 0.5, NULL)
INSERT INTO THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
	VALUES ('009', '002', 4, 1.5, NULL)

-- Q1
GO
SELECT GV.HOTEN, GV.LUONG FROM GIAOVIEN GV WHERE GV.PHAI = N'Nữ'
-- Q2
SELECT GV.HOTEN AS TENGV, GV.LUONG * 1.1 AS LUONGGV FROM GIAOVIEN GV
-- Q3
SELECT GV.MAGV
FROM GIAOVIEN GV WHERE GV.HOTEN LIKE N'Nguyễn%' AND GV.LUONG > 2000 
UNION 
SELECT BM.TRUONGBM
FROM BOMON BM WHERE YEAR(BM.NGAYNHANCHUC) >= 1995
-- Q4
SELECT GV.HOTEN FROM GIAOVIEN GV JOIN BOMON BM ON (GV.MABM = BM.MABM) AND (BM.MAKHOA = 'CNTT')
-- Q5
SELECT BM.*, GV.* FROM BOMON BM JOIN GIAOVIEN GV ON BM.TRUONGBM = GV.MAGV
-- Q6
SELECT GV.MAGV, GV.HOTEN, BM.* FROM GIAOVIEN GV JOIN BOMON BM ON GV.MABM = BM.MABM
-- Q7
SELECT DT.TENDT, GV.* FROM DETAI DT JOIN GIAOVIEN GV ON DT.GVCNDT = GV.MAGV
-- Q8
SELECT *
FROM KHOA KH JOIN GIAOVIEN GV ON KH.TRUONGKHOA = GV.MAGV
-- Q9
SELECT GV.*
FROM GIAOVIEN GV, THAMGIADT DT, BOMON BM 
WHERE DT.MADT = '006' AND GV.MAGV = DT.MAGV AND GV.MABM = BM.MABM AND BM.TENBM = N'Vi sinh'
-- Q10
SELECT DT.MADT, CD.TENCD, GV.HOTEN, GV.NGAYSINH, GV.DIACHI
FROM DETAI DT JOIN CHUDE CD ON DT.MACD = CD.MACD JOIN GIAOVIEN GV ON GV.MAGV = DT.GVCNDT
WHERE DT.CAPQL = N'ĐHQG'
-- Q11
SELECT * FROM GIAOVIEN A LEFT JOIN GIAOVIEN B ON A.MAGV = B.GVQLCM
-- Q12
SELECT GV.HOTEN
FROM GIAOVIEN GV WHERE GV.GVQLCM = (SELECT GV.MAGV FROM GIAOVIEN GV WHERE GV.HOTEN = N'Nguyễn Thanh Tùng') 
-- Q13
SELECT GV.HOTEN
FROM GIAOVIEN GV, BOMON BM WHERE GV.MAGV = BM.TRUONGBM AND BM.MABM = 'HTTT'
-- Q14
SELECT DISTINCT GV.HOTEN
FROM GIAOVIEN GV, DETAI DT, THAMGIADT TH, CHUDE CD 
WHERE (DT.MADT = TH.MADT AND TH.MAGV = GV.MAGV) AND (DT.MACD = CD.MACD AND CD.TENCD = N'Quản lý giáo dục')
-- Q15
SELECT DISTINCT CV.TENCV
FROM CONGVIEC CV, DETAI DT WHERE (CV.MADT = DT.MADT AND DT.TENDT = N'HTTT quản lý các trường ĐH') AND DATEDIFF(mm, CV.NGAYBD, '03/01/2008') = 0
-- Q16
SELECT A.HOTEN, B.HOTEN
FROM GIAOVIEN A LEFT JOIN GIAOVIEN B ON B.MAGV = A.GVQLCM
-- Q17
SELECT CV.TENCV
FROM CONGVIEC CV WHERE DATEDIFF(dd, CV.NGAYBD, '01/01/2007') < 0 AND DATEDIFF(dd, CV.NGAYBD, '08/01/2007') > 0
-- Q18
SELECT DISTINCT GV.HOTEN
FROM GIAOVIEN GV
WHERE GV.MABM = (SELECT BM.MABM FROM GIAOVIEN GV, BOMON BM WHERE BM.MABM = GV.MABM AND GV.HOTEN = N'Trần Trà Hương') AND GV.HOTEN != N'Trần Trà Hương'
-- Q19
SELECT DISTINCT GV.HOTEN
FROM GIAOVIEN GV, DETAI DT, BOMON BM WHERE GV.MAGV = BM.TRUONGBM AND GV.MAGV = DT.GVCNDT
-- Q20
SELECT GV.HOTEN
FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MAGV = BM.TRUONGBM AND GV.MAGV = KH.TRUONGKHOA
-- Q21
SELECT DISTINCT GV.HOTEN
FROM GIAOVIEN GV, DETAI DT, BOMON BM WHERE GV.MAGV = DT.GVCNDT AND GV.MAGV = BM.TRUONGBM
-- Q22
SELECT DISTINCT GV.MAGV
FROM GIAOVIEN GV, DETAI DT, KHOA KH WHERE GV.MAGV = KH.TRUONGKHOA AND GV.MAGV = DT.GVCNDT
-- Q23
SELECT DISTINCT GV.MAGV
FROM GIAOVIEN GV, BOMON BM, THAMGIADT TH WHERE (GV.MABM = 'HTTT') OR (GV.MAGV = TH.MAGV AND TH.MADT = '001')
-- Q24
SELECT GV.HOTEN
FROM GIAOVIEN GV WHERE GV.MABM = (SELECT GV.MABM FROM GIAOVIEN GV WHERE GV.MAGV = '002') AND GV.MAGV != '002'
-- Q25
SELECT GV.HOTEN
FROM GIAOVIEN GV, BOMON BM WHERE GV.MAGV = BM.TRUONGBM
-- Q26
SELECT GV.HOTEN, GV.LUONG
FROM GIAOVIEN GV
-- Q27
SELECT COUNT(*) AS SLGV, SUM(LUONG) AS TONGLUONG FROM GIAOVIEN 
-- Q28
SELECT MABM, COUNT(*) AS SLGV, AVG(LUONG) AS LUONGTRUNGBINH FROM GIAOVIEN GROUP BY MABM 
-- Q29
SELECT CHUDE.TENCD, COUNT(DETAI.MADT) AS SLDT FROM CHUDE LEFT JOIN DETAI ON CHUDE.MACD = DETAI.MACD GROUP BY CHUDE.MACD, CHUDE.TENCD
-- Q30
SELECT HOTEN, COUNT(DISTINCT THAMGIADT.MADT) AS SLDT FROM GIAOVIEN LEFT JOIN THAMGIADT ON GIAOVIEN.MAGV = THAMGIADT.MAGV GROUP BY GIAOVIEN.MAGV, GIAOVIEN.HOTEN
-- Q31
SELECT HOTEN, COUNT(DETAI.GVCNDT) SLCNDT FROM GIAOVIEN LEFT JOIN DETAI ON GIAOVIEN.MAGV = DETAI.GVCNDT GROUP BY GIAOVIEN.MAGV, GIAOVIEN.HOTEN
-- Q32
SELECT HOTEN, COUNT(NGUOITHAN.TEN) AS SLNT FROM GIAOVIEN LEFT JOIN NGUOITHAN ON GIAOVIEN.MAGV = NGUOITHAN.MAGV GROUP BY GIAOVIEN.MAGV, GIAOVIEN.HOTEN
-- Q33
SELECT HOTEN FROM GIAOVIEN, THAMGIADT WHERE GIAOVIEN.MAGV = THAMGIADT.MAGV GROUP BY GIAOVIEN.MAGV, GIAOVIEN.HOTEN HAVING COUNT(THAMGIADT.MADT) >= 3
-- Q34
SELECT COUNT(THAMGIADT.MAGV) AS SLTGUDX FROM DETAI, THAMGIADT WHERE DETAI.TENDT = N'Ứng dụng hóa học xanh' AND DETAI.MADT = THAMGIADT.MADT GROUP BY THAMGIADT.MADT
-- Q35
SELECT MAX(LUONG) AS LUONGCAONHATGV FROM GIAOVIEN
-- Q36
SELECT HOTEN FROM GIAOVIEN WHERE LUONG = (SELECT MAX(LUONG) FROM GIAOVIEN)
-- Q37
SELECT MAX(LUONG) AS LUONGCAONHATHTTT FROM GIAOVIEN WHERE MABM = 'HTTT'
-- Q38
SELECT HOTEN FROM GIAOVIEN 
WHERE YEAR(GIAOVIEN.NGAYSINH) = (SELECT MIN(YEAR(NGAYSINH)) FROM GIAOVIEN WHERE GIAOVIEN.MABM IN (SELECT BM.MABM FROM BOMON BM WHERE BM.TENBM = N'Hệ thống thông tin'))
-- Q39
SELECT HOTEN FROM GIAOVIEN 
WHERE YEAR(GIAOVIEN.NGAYSINH) = (SELECT MAX(YEAR(NGAYSINH)) FROM GIAOVIEN WHERE GIAOVIEN.MABM IN (SELECT BM.MABM FROM BOMON BM WHERE BM.MAKHOA IN (SELECT MAKHOA FROM KHOA WHERE TENKHOA = N'Công nghệ thông tin')))
-- Q40
SELECT HOTEN, TENKHOA
FROM GIAOVIEN, KHOA, BOMON 
WHERE LUONG = (SELECT MAX(LUONG) FROM GIAOVIEN) AND KHOA.MAKHOA = BOMON.MAKHOA AND BOMON.MABM = GIAOVIEN.MABM
-- Q41
SELECT * FROM GIAOVIEN GV1 WHERE LUONG >= ALL (SELECT LUONG FROM GIAOVIEN GV2 WHERE GV1.MABM = GV2.MABM AND GV1.MAGV != GV2.MAGV)
-- Q42
SELECT TENDT
FROM DETAI WHERE MADT NOT IN (SELECT MADT FROM THAMGIADT WHERE MAGV IN (SELECT MAGV FROM GIAOVIEN WHERE HOTEN = N'Nguyễn Hoài An'))
-- Q43
SELECT TENDT, HOTEN AS GVCNDT
FROM DETAI, GIAOVIEN 
WHERE GIAOVIEN.MAGV = DETAI.GVCNDT AND MADT NOT IN (SELECT MADT FROM THAMGIADT WHERE MAGV IN (SELECT MAGV FROM GIAOVIEN WHERE HOTEN = N'Nguyễn Hoài An'))
-- Q44
SELECT HOTEN
FROM (SELECT HOTEN, MAGV FROM GIAOVIEN WHERE MABM IN (SELECT MABM FROM BOMON WHERE MAKHOA IN (SELECT MAKHOA FROM KHOA WHERE TENKHOA = N'Công nghệ thông tin'))) as GV
WHERE GV.MAGV NOT IN (SELECT MAGV FROM THAMGIADT)
-- Q45
SELECT * FROM GIAOVIEN WHERE MAGV NOT IN (SELECT MAGV FROM THAMGIADT)
-- Q46
SELECT GV1.HOTEN 
FROM GIAOVIEN GV1 WHERE LUONG > (SELECT LUONG FROM GIAOVIEN GV2 WHERE GV2.HOTEN = N'Nguyễn Hoài An')
-- Q47
SELECT GV.HOTEN
FROM GIAOVIEN GV, BOMON BM, THAMGIADT TH WHERE GV.MAGV = BM.TRUONGBM AND GV.MAGV = TH.MAGV 
GROUP BY GV.MAGV, GV.HOTEN
HAVING COUNT(TH.MADT) >= 1 
-- Q48
SELECT * FROM GIAOVIEN GV1 
WHERE EXISTS (SELECT * FROM GIAOVIEN GV2 WHERE GV1.HOTEN LIKE GV2.HOTEN AND GV1.PHAI = GV2.PHAI AND GV1.MABM = GV2.MABM AND GV1.MAGV != GV2.MAGV)
-- Q49
SELECT * FROM GIAOVIEN WHERE LUONG > ANY (SELECT GV.LUONG FROM GIAOVIEN GV, BOMON BM WHERE GV.MABM = BM.MABM AND BM.TENBM = N'Công nghệ phần mềm')
-- Q50
SELECT * 
FROM GIAOVIEN WHERE LUONG > ALL (SELECT GV.LUONG FROM GIAOVIEN GV, BOMON BM WHERE GV.MABM = BM.MABM AND BM.TENBM = N'Vi sinh')
-- Q51
SELECT KH.TENKHOA
FROM KHOA KH, GIAOVIEN GV, BOMON BM WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA 
GROUP BY KH.MAKHOA, KH.TENKHOA HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA GROUP BY KH.MAKHOA)
-- Q52
SELECT GV.HOTEN
FROM GIAOVIEN GV WHERE GV.MAGV IN (SELECT DT.GVCNDT FROM DETAI DT GROUP BY DT.GVCNDT 
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM DETAI DT GROUP BY DT.GVCNDT))
-- Q53
SELECT GV.MABM
FROM GIAOVIEN GV GROUP BY GV.MABM
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM GIAOVIEN GV GROUP BY GV.MABM)
-- Q54
SELECT HOTEN, TENBM FROM GIAOVIEN, BOMON
WHERE BOMON.MABM = GIAOVIEN.MABM AND GIAOVIEN.MAGV IN (SELECT MAGV FROM THAMGIADT GROUP BY MAGV HAVING COUNT(MADT) >= ALL (SELECT COUNT(MADT) FROM THAMGIADT GROUP BY MAGV))
-- Q55
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH WHERE GV.MAGV = TH.MAGV AND GV.MABM = N'HTTT' GROUP BY GV.MAGV, GV.HOTEN
HAVING COUNT(MADT) >= ALL (SELECT COUNT(TH.MADT) FROM THAMGIADT TH WHERE GV.MAGV = TH.MAGV GROUP BY TH.MAGV)
-- Q56
SELECT HOTEN, TENBM FROM GIAOVIEN, BOMON
WHERE BOMON.MABM = GIAOVIEN.MABM AND GIAOVIEN.MAGV IN (SELECT MAGV FROM NGUOITHAN GROUP BY MAGV HAVING COUNT(MAGV) >= ALL (SELECT COUNT(MAGV) FROM NGUOITHAN GROUP BY MAGV))
-- Q57
SELECT HOTEN
FROM BOMON, GIAOVIEN  
WHERE GIAOVIEN.MAGV = BOMON.TRUONGBM AND GIAOVIEN.MAGV IN (SELECT GVCNDT FROM DETAI GROUP BY GVCNDT HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM DETAI GROUP BY GVCNDT))
-- Q58
--EXCEPT
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT CD.MACD FROM CHUDE CD EXCEPT (SELECT DT.MACD FROM DETAI DT, THAMGIADT TH WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT))
-- NOT EXISTS
SELECT GV.HOTEN
FROM GIAOVIEN GV 
WHERE NOT EXISTS (SELECT * FROM CHUDE CD WHERE NOT EXISTS (SELECT * FROM DETAI DT, THAMGIADT TH WHERE GV.MAGV = TH.MAGV AND DT.MADT = TH.MADT AND DT.MACD = CD.MACD))
-- COUNT
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT
GROUP BY GV.MAGV, GV.HOTEN
HAVING COUNT(DT.MACD) = (SELECT COUNT(*) FROM CHUDE)
-- Q59
-- EXCEPT 
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT GV.MAGV FROM GIAOVIEN GV WHERE GV.MABM = 'HTTT' EXCEPT (SELECT TH.MAGV FROM THAMGIADT TH WHERE TH.MADT = DT.MADT))
-- NOT EXISTS
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT * FROM GIAOVIEN GV WHERE GV.MABM = 'HTTT' AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MADT = DT.MADT AND TH.MAGV = GV.MAGV))
-- COUNT
SELECT DT.TENDT
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND GV.MABM = 'HTTT'
GROUP BY DT.TENDT
HAVING COUNT(DISTINCT GV.MAGV) = (SELECT COUNT(*) FROM GIAOVIEN GV1 WHERE GV1.MABM = 'HTTT')
-- Q60
-- EXCEPT
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT GV.MAGV FROM GIAOVIEN GV, BOMON BM WHERE GV.MABM = BM.MABM AND BM.TENBM = N'Hệ thống thông tin' 
EXCEPT (SELECT TH.MAGV FROM THAMGIADT TH WHERE TH.MADT = DT.MADT))
-- NOT EXISTS
SELECT DT.TENDT 
FROM DETAI DT
WHERE NOT EXISTS (SELECT * FROM GIAOVIEN GV, BOMON BM WHERE GV.MABM = BM.MABM AND BM.TENBM = N'Hệ thống thông tin' 
AND NOT EXISTS (SELECT TH.MAGV FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = DT.MADT))
-- COUNT
SELECT DT.TENDT
FROM GIAOVIEN GV, THAMGIADT TH, BOMON BM, DETAI DT WHERE TH.MADT = DT.MADT AND TH.MAGV = GV.MAGV AND GV.MABM = BM.MABM AND BM.TENBM = N'Hệ thống thông tin'
GROUP BY DT.TENDT
HAVING COUNT(DISTINCT TH.MAGV) = (SELECT COUNT(*) FROM GIAOVIEN GV1, BOMON BM1 WHERE GV1.MABM = BM1.MABM AND BM1.TENBM = N'Hệ thống thông tin')
-- Q61
-- EXCEPT
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT DT.MADT FROM DETAI DT WHERE DT.MADT = 'QLGD' EXCEPT (SELECT TH.MADT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV))
-- NOT EXISTS
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT * FROM DETAI DT WHERE DT.MADT = 'QLGD' AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = DT.MADT))
-- COUNT
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND DT.MACD = 'QLGD'
GROUP BY GV.HOTEN
HAVING COUNT(DT.MADT) = (SELECT COUNT(*) FROM DETAI DT WHERE DT.MACD = 'QLGD')
-- Q62
-- EXCEPT
SELECT GV1.HOTEN
FROM GIAOVIEN GV1
WHERE NOT EXISTS (SELECT TH1.MADT FROM THAMGIADT TH1, GIAOVIEN GV2 WHERE TH1.MAGV = GV2.MAGV AND GV2.HOTEN = N'Trần Trà Hương' 
EXCEPT (SELECT TH2.MADT FROM THAMGIADT TH2 WHERE TH2.MAGV = GV1.MAGV))
AND GV1.HOTEN NOT LIKE N'Trần Trà Hương'
-- NOT EXISTS
SELECT GV1.HOTEN
FROM GIAOVIEN GV1
WHERE NOT EXISTS (SELECT * FROM THAMGIADT TH1, GIAOVIEN GV2 WHERE TH1.MAGV = GV2.MAGV AND GV2.HOTEN = N'Trần Trà Hương' 
AND NOT EXISTS (SELECT * FROM THAMGIADT TH2  WHERE TH2.MAGV = GV1.MAGV AND TH2.MADT = TH1.MADT))
AND GV1.HOTEN NOT LIKE N'Trần Trà Hương'
-- COUNT
SELECT GV1.HOTEN
FROM GIAOVIEN GV1, THAMGIADT TH1 WHERE GV1.MAGV = TH1.MAGV AND TH1.MADT IN (SELECT TH2.MADT FROM THAMGIADT TH2, GIAOVIEN GV2 WHERE GV2.HOTEN = N'Trần Trà Hương' 
AND TH2.MAGV = GV2.MAGV) GROUP BY GV1.MAGV, GV1.HOTEN
HAVING COUNT(DISTINCT TH1.MADT) = (SELECT COUNT(DISTINCT TH2.MADT) FROM THAMGIADT TH2, GIAOVIEN GV2 WHERE GV2.HOTEN = N'Trần Trà Hương' 
AND TH2.MAGV = GV2.MAGV) 
AND GV1.HOTEN NOT LIKE N'Trần Trà Hương' 
-- Q63
-- EXCEPT 
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT GV.MAGV FROM GIAOVIEN GV WHERE GV.MABM = 'HHC' EXCEPT (SELECT TH.MAGV FROM THAMGIADT TH WHERE TH.MADT = DT.MADT))
-- NOT EXISTS
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT * FROM GIAOVIEN GV WHERE GV.MABM = 'HHC' AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MADT = DT.MADT AND TH.MAGV = GV.MAGV))
-- COUNT
SELECT DT.TENDT
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND GV.MABM = 'HHC'
GROUP BY DT.TENDT
HAVING COUNT(DISTINCT GV.MAGV) = (SELECT COUNT(*) FROM GIAOVIEN GV1 WHERE GV1.MABM = 'HHC')
-- Q64
-- EXCEPT
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT CV.SOTT FROM CONGVIEC CV WHERE CV.MADT = '006' EXCEPT (SELECT TH.STT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = '006'))
-- NOT EXISTS
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT * FROM CONGVIEC CV WHERE CV.MADT = '006' AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = CV.MADT AND CV.SOTT = TH.STT))
-- COUNT
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH WHERE GV.MAGV = TH.MAGV AND TH.MADT = '006'
GROUP BY GV.HOTEN, GV.MAGV
HAVING COUNT(DISTINCT TH.STT) = (SELECT COUNT(*) FROM CONGVIEC CV WHERE CV.MADT = '006')
-- Q65
-- EXCEPT
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT DT.MADT FROM DETAI DT, CHUDE CD 
WHERE DT.MACD = CD.MACD AND CD.TENCD = N'Ứng dụng công nghệ' EXCEPT (SELECT TH.MADT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV))
-- NOT EXISTS
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT * FROM DETAI DT, CHUDE CD WHERE DT.MACD = CD.MACD AND CD.TENCD = N'Ứng dụng công nghệ' 
AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = DT.MADT))
-- COUNT
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT, CHUDE CD WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND DT.MACD = CD.MACD AND CD.TENCD = N'Ứng dụng công nghệ'
GROUP BY GV.HOTEN, GV.MAGV
HAVING COUNT(DT.MADT) = (SELECT COUNT(*) FROM DETAI DT, CHUDE CD WHERE DT.MACD = CD.MACD AND CD.TENCD = N'Ứng dụng công nghệ')
-- Q66
-- EXCEPT
SELECT GV1.HOTEN
FROM GIAOVIEN GV1
WHERE NOT EXISTS (SELECT DT1.MADT FROM DETAI DT1, GIAOVIEN GV2 WHERE DT1.GVCNDT = GV2.MAGV AND GV2.HOTEN = N'Trần Trà Hương' 
EXCEPT (SELECT TH.MADT FROM THAMGIADT TH WHERE TH.MAGV = GV1.MAGV))
-- NOT EXISTS
SELECT GV1.HOTEN
FROM GIAOVIEN GV1
WHERE NOT EXISTS (SELECT * FROM DETAI DT1, GIAOVIEN GV2 WHERE DT1.GVCNDT = GV2.MAGV AND GV2.HOTEN = N'Trần Trà Hương' 
AND NOT EXISTS (SELECT * FROM THAMGIADT TH  WHERE TH.MAGV = GV1.MAGV AND DT1.MADT = TH.MADT))
-- COUNT
SELECT GV1.HOTEN
FROM GIAOVIEN GV1, THAMGIADT TH1, DETAI DT WHERE GV1.MAGV = TH1.MAGV AND TH1.MADT = DT.MADT
GROUP BY GV1.MAGV, GV1.HOTEN
HAVING COUNT(DISTINCT DT.MADT) = (SELECT COUNT(*) FROM DETAI DT1, GIAOVIEN GV2 WHERE DT1.GVCNDT = GV2.MAGV AND GV2.HOTEN = N'Trần Trà Hương') 
-- Q67
-- EXCEPT 
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT GV.MAGV FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.MAKHOA = 'CNTT' 
EXCEPT (SELECT GV2.MAGV FROM GIAOVIEN GV2, THAMGIADT TH WHERE GV2.MAGV = TH.MAGV AND TH.MADT = DT.MADT))
-- NOT EXISTS
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT * FROM GIAOVIEN GV, BOMON BM, KHOA KH 
WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.MAKHOA = 'CNTT' 
AND NOT EXISTS (SELECT TH.MAGV FROM THAMGIADT TH WHERE TH.MADT = DT.MADT AND TH.MAGV = GV.MAGV))
-- COUNT
SELECT DT.TENDT
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT, BOMON BM, KHOA KH 
WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND KH.MAKHOA = 'CNTT'
GROUP BY DT.TENDT, DT.MADT
HAVING COUNT(DISTINCT GV.MAGV) = (SELECT COUNT(*) FROM GIAOVIEN GV1, BOMON BM1, KHOA KH1 
WHERE GV1.MABM = BM1.MABM AND BM1.MAKHOA = KH1.MAKHOA AND KH1.MAKHOA = 'CNTT')
-- Q68
-- EXCEPT
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT CV.SOTT FROM CONGVIEC CV, DETAI DT WHERE CV.MADT = DT.MADT AND DT.TENDT = N'Nghiên cứu tế bào gốc' 
EXCEPT (SELECT TH.STT FROM THAMGIADT TH, DETAI DT1 WHERE TH.MAGV = GV.MAGV AND TH.MADT = DT1.MADT AND DT1.TENDT = N'Nghiên cứu tế bào gốc'))
-- NOT EXISTS
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT * FROM CONGVIEC CV, DETAI DT 
WHERE CV.MADT = DT.MADT AND DT.TENDT = N'Nghiên cứu tế bào gốc' 
AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = DT.MADT AND CV.SOTT = TH.STT AND DT.TENDT = N'Nghiên cứu tế bào gốc'))
-- COUNT
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND DT.TENDT = N'Nghiên cứu tế bào gốc'
GROUP BY GV.HOTEN, GV.MAGV
HAVING COUNT(DISTINCT TH.STT) = (SELECT COUNT(*) FROM CONGVIEC CV, DETAI DT WHERE CV.MADT = DT.MADT AND DT.TENDT = N'Nghiên cứu tế bào gốc')
-- Q69
-- EXCEPT
SELECT GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT DT.MADT FROM DETAI DT WHERE DT.KINHPHI > 100 EXCEPT (SELECT TH.MADT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV))
-- NOT EXISTS
SELECT GV.HOTEN
FROM GIAOVIEN GV 
WHERE NOT EXISTS (SELECT * FROM DETAI DT WHERE DT.KINHPHI > 100 AND NOT EXISTS (SELECT * FROM THAMGIADT TH WHERE TH.MADT = DT.MADT AND TH.MAGV = GV.MAGV))
-- COUNT
SELECT GV.HOTEN
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT
WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND DT.KINHPHI > 100
GROUP BY GV.HOTEN, GV.MAGV 
HAVING COUNT(DISTINCT DT.MADT) = (SELECT COUNT(*) FROM DETAI DT WHERE DT.KINHPHI > 100)
-- Q70
-- EXCEPT 
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT GV.MAGV FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.MAKHOA = 'SH' 
EXCEPT (SELECT GV2.MAGV FROM GIAOVIEN GV2, THAMGIADT TH WHERE GV2.MAGV = TH.MAGV AND TH.MADT = DT.MADT))
-- NOT EXISTS
SELECT DT.TENDT
FROM DETAI DT
WHERE NOT EXISTS (SELECT * FROM GIAOVIEN GV, BOMON BM, KHOA KH 
WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.MAKHOA = 'SH' 
AND NOT EXISTS (SELECT TH.MAGV FROM THAMGIADT TH WHERE TH.MADT = DT.MADT AND TH.MAGV = GV.MAGV))
-- COUNT
SELECT DT.TENDT
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT, BOMON BM, KHOA KH 
WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND KH.MAKHOA = 'SH'
GROUP BY DT.TENDT, DT.MADT
HAVING COUNT(DISTINCT GV.MAGV) = (SELECT COUNT(*) FROM GIAOVIEN GV1, BOMON BM1, KHOA KH1 
WHERE GV1.MABM = BM1.MABM AND BM1.MAKHOA = KH1.MAKHOA AND KH1.MAKHOA = 'SH')
-- Q71
-- EXCEPT
SELECT GV.MAGV, GV.HOTEN, GV.NGAYSINH
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT CV.SOTT FROM CONGVIEC CV, DETAI DT WHERE CV.MADT = DT.MADT AND DT.TENDT = N'Ứng dụng hóa học xanh'
EXCEPT (SELECT TH.STT FROM THAMGIADT TH, DETAI DT1 WHERE TH.MADT = DT1.MADT AND TH.MAGV = GV.MAGV AND DT1.TENDT = N'Ứng dụng hóa học xanh'))
-- NOT EXISTS
SELECT GV.MAGV, GV.HOTEN, GV.NGAYSINH
FROM GIAOVIEN GV
WHERE NOT EXISTS (SELECT CV.SOTT FROM CONGVIEC CV, DETAI DT WHERE CV.MADT = DT.MADT AND DT.TENDT = N'Ứng dụng hóa học xanh'
AND NOT EXISTS (SELECT TH.STT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND TH.MADT = DT.MADT AND DT.TENDT = N'Ứng dụng hóa học xanh'))
-- COUNT
SELECT GV.MAGV, GV.HOTEN, GV.NGAYSINH
FROM GIAOVIEN GV, THAMGIADT TH, DETAI DT
WHERE GV.MAGV = TH.MAGV AND TH.MADT = DT.MADT AND DT.TENDT = N'Ứng dụng hóa học xanh'
GROUP BY GV.MAGV, GV.HOTEN, GV.NGAYSINH
HAVING COUNT(DISTINCT TH.STT) = (SELECT COUNT(CV.SOTT) FROM CONGVIEC CV, DETAI DT WHERE CV.MADT = DT.MADT AND DT.TENDT = N'Ứng dụng hóa học xanh')
-- Q72
-- EXCEPT
SELECT GV.MAGV, GV.HOTEN, BM.TENBM, GV.GVQLCM
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MABM = BM.MABM AND GV.MAGV = GV.GVQLCM AND NOT EXISTS (SELECT DT.MADT FROM DETAI DT, CHUDE CD WHERE DT.MACD = CD.MACD AND CD.TENCD = N'Nghiên cứu phát triển'
EXCEPT (SELECT TH.MADT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV))
-- NOT EXISTS
SELECT GV.MAGV, GV.HOTEN, BM.TENBM, GV.GVQLCM
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MABM = BM.MABM AND GV.MAGV = GV.GVQLCM 
AND NOT EXISTS (SELECT DT.MADT FROM DETAI DT, CHUDE CD WHERE DT.MACD = CD.MACD AND CD.TENCD = N'Nghiên cứu phát triển'
AND NOT EXISTS (SELECT TH.MADT FROM THAMGIADT TH WHERE TH.MAGV = GV.MAGV AND DT.MADT = TH.MADT))
-- COUNT
SELECT GV.MAGV, GV.HOTEN, BM.TENBM, GV.GVQLCM
FROM GIAOVIEN GV, BOMON BM, THAMGIADT TH, DETAI DT, CHUDE CD
WHERE GV.MABM = BM.MABM AND GV.MAGV = GV.GVQLCM AND TH.MAGV = GV.MAGV AND TH.MADT = DT.MADT AND DT.MACD = CD.MACD AND CD.TENCD = N'Nghiên cứu phát triển'
GROUP BY GV.MAGV, GV.HOTEN, BM.TENBM, GV.GVQLCM
HAVING COUNT(DISTINCT DT.MADT) = (SELECT COUNT(DT.MADT) FROM DETAI DT, CHUDE CD WHERE DT.MACD = CD.MACD AND CD.TENCD = N'Nghiên cứu phát triển')
-- 73
SELECT DISTINCT GV.HOTEN, GV.NGAYSINH, KH.TENKHOA
FROM GIAOVIEN GV, KHOA KH, BOMON BM WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA
AND NOT EXISTS (SELECT * FROM DETAI DT, THAMGIADT TG, GIAOVIEN GV1 WHERE DT.MADT = TG.MADT AND TG.MAGV = GV1.MAGV AND GV1.HOTEN = N'Nguyễn Hoài An'
AND NOT EXISTS (SELECT * FROM THAMGIADT TG1 WHERE TG1.MAGV = GV.MAGV AND TG1.MADT = TG.MADT))
AND GV.HOTEN NOT LIKE N'Nguyễn Hoài An'
-- 75
SELECT GV.MAGV, GV.HOTEN, BM.TENBM AS LAMTRUONGBOMON
FROM GIAOVIEN GV, BOMON BM WHERE GV.MAGV = BM.TRUONGBM
-- 77
SELECT GV.HOTEN, DT.TENDT
FROM GIAOVIEN GV, DETAI DT WHERE GV.MAGV = DT.GVCNDT
-- 74
SELECT GV.HOTEN
FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.TENKHOA = N'Công nghệ thông tin'
-- 74
SELECT GV.HOTEN
FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.TENKHOA = N'Công nghệ thông tin'
AND NOT EXISTS (SELECT * FROM DETAI DT, CONGVIEC CV, THAMGIADT TG, GIAOVIEN GV1 WHERE TG.MADT = CV.MADT AND CV.MADT = DT.MADT 
AND TG.MAGV = GV1.MAGV AND GV1.MAGV = '002'
AND NOT EXISTS (SELECT * FROM THAMGIADT TG1 WHERE TG1.MAGV = GV.MAGV AND TG1.MADT = CV.MADT))
AND GV.MAGV NOT LIKE '002'

SELECT BM.MABM, BM.TRUONGBM
FROM GIAOVIEN GV, BOMON BM, KHOA KH WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.TENKHOA = N'Công nghệ thông tin'
GROUP BY BM.MABM, BM.TRUONGBM
HAVING COUNT(*) >= ALL(SELECT COUNT(*) FROM GIAOVIEN GV, BOMON BM, KHOA KH 
WHERE GV.MABM = BM.MABM AND BM.MAKHOA = KH.MAKHOA AND KH.TENKHOA = N'Công nghệ thông tin' GROUP BY BM.MABM)